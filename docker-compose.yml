version: "3"

services:
  json-server:
    build:
      context: serialization_server/
      dockerfile: server.Dockerfile
    command: python3 ./server.py
    environment:
      METHOD: JSON
      HOST: 0.0.0.0
      PORT: $JSON_PORT
      MCAST_IP: $MCAST_IP
      MCAST_PORT: $MCAST_PORT
  
  messagepack-server:
    build:
      context: serialization_server/
      dockerfile: server.Dockerfile
    command: python3 ./server.py
    environment:
      METHOD: MessagePack
      HOST: 0.0.0.0
      PORT: $MESSAGEPACK_PORT
      MCAST_IP: $MCAST_IP
      MCAST_PORT: $MCAST_PORT
  
  native-server:
    build:
      context: serialization_server/
      dockerfile: server.Dockerfile
    command: python3 ./server.py
    environment:
      METHOD: Native
      HOST: 0.0.0.0
      PORT: $NATIVE_PORT
      MCAST_IP: $MCAST_IP
      MCAST_PORT: $MCAST_PORT
  
  yaml-server:
    build:
      context: serialization_server/
      dockerfile: server.Dockerfile
    command: python3 ./server.py
    environment:
      METHOD: YAML
      HOST: 0.0.0.0
      PORT: $YAML_PORT
      MCAST_IP: $MCAST_IP
      MCAST_PORT: $MCAST_PORT
  
  xml-server:
    build:
      context: serialization_server/
      dockerfile: server.Dockerfile
    command: python3 ./server.py
    environment:
      METHOD: XML
      HOST: 0.0.0.0
      PORT: $XML_PORT
      MCAST_IP: $MCAST_IP
      MCAST_PORT: $MCAST_PORT

  proxy:
    build:
      context: proxy/
      dockerfile: proxy.Dockerfile
    command: python3 ./proxy.py
    environment:
      HOST: 0.0.0.0
      PORT: 4242
      JSON: $JSON_PORT
      MESSAGEPACK: $MESSAGEPACK_PORT
      NATIVE: $NATIVE_PORT
      YAML: $YAML_PORT
      XML: $XML_PORT
      MCAST_IP: $MCAST_IP
      MCAST_PORT: $MCAST_PORT
    ports: 
      - "4242:4242/udp"
    depends_on:
      - json-server
      - messagepack-server
      - native-server
      - yaml-server
      - xml-server